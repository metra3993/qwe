{% extends 'base.html' %}

{% block title %}–ü—Ä–æ–¥—É–∫—Ç—ã - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>üõí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏</h1>
        <a href="{% url 'dashboard:product_create' %}" class="btn btn-primary">+ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç</a>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="get" class="filters-form">
                <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                    <input type="text" name="search" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –±—Ä–µ–Ω–¥—É..." class="filter-input" value="{{ search_query }}" style="flex: 1; min-width: 250px;">

                    <select name="category" class="filter-select" style="min-width: 180px;">
                        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                        {% for category in categories %}
                            <option value="{{ category.slug }}" {% if request.GET.category == category.slug %}selected{% endif %}>
                                {{ category.icon }} {{ category.name }}
                            </option>
                        {% endfor %}
                    </select>

                    <select name="available" class="filter-select" style="min-width: 150px;">
                        <option value="">–í—Å–µ</option>
                        <option value="1" {% if request.GET.available == '1' %}selected{% endif %}>–í –Ω–∞–ª–∏—á–∏–∏</option>
                        <option value="0" {% if request.GET.available == '0' %}selected{% endif %}>–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</option>
                    </select>

                    <button type="submit" class="btn btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>

                    {% if request.GET.search or request.GET.category or request.GET.available %}
                        <a href="{% url 'dashboard:products_list' %}" class="btn">–°–±—Ä–æ—Å–∏—Ç—å</a>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ -->
    {% if products %}
        <p class="text-secondary mb-3">–ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤: <strong>{{ products|length }}</strong></p>

        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th style="width: 80px;">–§–æ—Ç–æ</th>
                        <th>–ü—Ä–æ–¥—É–∫—Ç</th>
                        <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                        <th>–¶–µ–Ω–∞</th>
                        <th>–û—Å—Ç–∞—Ç–æ–∫</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th style="width: 220px; text-align: right;">–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in products %}
                        <tr>
                            <td>
                                {% if product.main_image %}
                                    <img src="{{ product.main_image.image.url }}" alt="{{ product.name }}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px;">
                                {% else %}
                                    <div style="width: 60px; height: 60px; background: var(--color-hover); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                                        üõí
                                    </div>
                                {% endif %}
                            </td>
                            <td>
                                <strong>{{ product.name }}</strong>
                                <p class="text-sm text-secondary mb-0">
                                    {{ product.quantity|floatformat:0 }} {{ product.get_unit_display }}
                                    {% if product.brand %} ‚Ä¢ {{ product.brand }}{% endif %}
                                </p>
                            </td>
                            <td>
                                <span class="text-sm">{{ product.category.icon }} {{ product.category.name }}</span>
                            </td>
                            <td>
                                {% if product.discount_percent > 0 %}
                                    <div>
                                        <span style="text-decoration: line-through; color: var(--color-secondary); font-size: 12px;">{{ product.price|floatformat:0 }} ‚ÇΩ</span>
                                        <strong style="color: var(--color-danger);">{{ product.final_price|floatformat:0 }} ‚ÇΩ</strong>
                                        <span class="badge-sale" style="font-size: 11px; padding: 2px 6px; background: var(--color-danger); color: white; border-radius: 4px; margin-left: 4px;">-{{ product.discount_percent }}%</span>
                                    </div>
                                {% else %}
                                    <strong>{{ product.price|floatformat:0 }} ‚ÇΩ</strong>
                                {% endif %}
                            </td>
                            <td>
                                <span class="{% if product.stock < 10 %}text-danger{% elif product.stock < 50 %}text-warning{% endif %}">
                                    {{ product.stock }} —à—Ç
                                </span>
                            </td>
                            <td>
                                {% if product.is_available %}
                                    <span class="status-badge status-available">–í –Ω–∞–ª–∏—á–∏–∏</span>
                                {% else %}
                                    <span class="status-badge status-unavailable">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</span>
                                {% endif %}

                                {% if product.is_new %}
                                    <span class="status-badge status-new">–ù–æ–≤–∏–Ω–∫–∞</span>
                                {% endif %}

                                {% if product.is_featured %}
                                    <span class="status-badge status-featured">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π</span>
                                {% endif %}

                                {% if product.is_organic %}
                                    <span class="status-badge status-organic">üå± –≠–∫–æ</span>
                                {% endif %}
                            </td>
                            <td style="text-align: right;">
                                <a href="{% url 'products:detail' product.pk %}" class="btn btn-sm" target="_blank" title="–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å">üëÅÔ∏è</a>
                                <a href="{% url 'dashboard:product_edit' product.pk %}" class="btn btn-sm btn-primary" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
                                <a href="{% url 'dashboard:product_delete' product.pk %}" class="btn btn-sm btn-danger" title="–£–¥–∞–ª–∏—Ç—å" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ–¥—É–∫—Ç?')">üóëÔ∏è</a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="text-center py-5">
            <div style="font-size: 64px; margin-bottom: 24px;">üì¶</div>
            <h2>–ü—Ä–æ–¥—É–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h2>
            <p class="text-secondary mb-3">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</p>
            <a href="{% url 'dashboard:product_create' %}" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç</a>
        </div>
    {% endif %}
</div>

<style>
.filter-input,
.filter-select {
    padding: 10px 14px;
    border: 1px solid var(--color-border);
    border-radius: 8px;
    font-size: 15px;
    font-family: var(--font-main);
    transition: var(--transition);
    background: white;
}

.filter-input:focus,
.filter-select:focus {
    outline: none;
    border-color: var(--color-accent);
    box-shadow: 0 0 0 3px rgba(82, 160, 47, 0.1);
}

.status-badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    white-space: nowrap;
    margin: 2px;
}

.status-available {
    background: #e8f5e9;
    color: #2e7d32;
}

.status-unavailable {
    background: #ffebee;
    color: #c62828;
}

.status-new {
    background: #e3f2fd;
    color: #1565c0;
}

.status-featured {
    background: #fff8e1;
    color: #f57c00;
}

.status-organic {
    background: #f1f8e9;
    color: #558b2f;
}

.btn-danger {
    background: var(--color-danger);
    color: white;
}

.btn-danger:hover {
    background: #c62828;
}

.text-warning {
    color: #f57c00;
    font-weight: 600;
}

.text-danger {
    color: var(--color-danger);
    font-weight: 600;
}

.table {
    background: white;
}

.table thead th {
    background: var(--color-hover);
    font-weight: 600;
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--color-secondary);
    padding: 12px;
}

.table tbody td {
    padding: 16px 12px;
    vertical-align: middle;
    border-bottom: 1px solid var(--color-border);
}

.table tbody tr:hover {
    background: var(--color-hover);
}
</style>
{% endblock %}
